<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <style>
      body {
        background: url("https://drive.google.com/uc?export=view&id=12wUhtXSH5UuQH5kzXx5pqJdEOLOiXvm2") no-repeat center center fixed;
        background-size: cover;
      }
      select{
        width: 200px;
        margin-left: 10px;
      }
      input{
        width: 192px;
        margin-left: 10px;
      }
      .inputOther{
        margin-top: 3px;
        width: 192px;
        margin-left: 10px;
      }
      label{
        font-weight: bold;
        text-align: right;
        width: 200px;
        margin-right: 10px;
      }
      .formRow{
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .buttonRight{
        border: none;
        padding: 10px;
        display: block;
        margin-right: 20px;
        background-color: #BFD732;
        color: black;
        border-radius: 20px;
      }
      .buttonLeft{
        border: none;
        padding: 10px;
        display: block;
        margin-right: 20px;
        background-color: #BFD732;
        color: black;
        border-radius: 20px;
      }
      .swal-modal{
        font-family:Arial;
        border-radius: 0px;
      }
      .swal-title{
        font-size: 20px;
      }
      .swal-text{
        font-size: 15px;
      }
      .swal-button{
        background-color: #BFD732;
        border-radius: 20px;
        color: black;
      }
    </style>
    <script>

      google.script.run.withSuccessHandler(function (opciones){
        cargarOpciones(opciones,"bdOC");}).valuesRangoBDSize("F2:F");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpciones(opciones,"bdPJ");}).valuesRangoBDSize("G2:G");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpciones(opciones,"bdPM");}).valuesRangoBDSize("B2:B");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpciones(opciones,"bdTM");}).valuesRangoBDSize("C2:C");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpciones(opciones,"bdMSH");}).valuesRangoBDSize2("A2:A");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpciones(opciones,"bdR");}).valuesRangoBDSize("Q2:Q");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpcionesFecha(opciones,"bdSF");}).valuesFechaRangoBDSize("O2:O");
      google.script.run.withSuccessHandler(function (opciones){
        cargarOpcionesFecha(opciones,"bdED");}).valuesFechaRangoBDSize("P2:P");

      function cargarOpciones(opciones,selectId) {
        var select = document.getElementById(selectId);
        var option = document.createElement("option");
        option.value = "";
        option.text = "";
        select.add(option);

        opciones.forEach(function (opcion) {
          var option = document.createElement("option");
          option.value = opcion;
          option.text = opcion;
          select.add(option);
        });
        
        var option = document.createElement("option");
        option.value = "otra";
        option.text = "Other";
        select.add(option);
      }
      function cargarOpcionesFecha(opciones,selectId) {
        var select = document.getElementById(selectId);
        var option = document.createElement("option");
        option.value = "";
        option.text = "";
        select.add(option);

        for(var i = 0; i < opciones.length; i++){
          var option = document.createElement("option");
          option.value = opciones[i][1];
          option.text = opciones[i][0];
          select.add(option);
        }
      }

    </script>
  </head>
  <body style='margin: 0; padding: 0;'>
    <br></br>
    <div style='background-color: #F5F6F7; margin: 0 auto; padding: 30px; max-width: 500px;font-family: Arial;'>

      <!-- Logos -->
      <div style='background-color: #FFFFFF; margin: 0 auto; padding: 20px; overflow: hidden;'>
        <img src="https://drive.google.com/uc?export=view&id=1R7kLBfjaIN132U8YQuR3EKKz5eGv7A2I" style="width: 150px; height: auto;float: left;">
        <img src="https://drive.google.com/uc?export=view&id=1oh-1ZCvpeo8kwz4-Tk5f1M3ymYn2uqKh" style="width: 200px; height: auto;float: right;">
      </div>
      <!-- Titulo 1 -->
      <h2 style='background-color: #444444 ;color: white;'><center>Add New Business Down Size</center></h2>

      <!-- Marco blanco de la tabla -->
      <div style='background-color: #FFFFFF; margin: 0 auto; padding: 30px;border-radius: 10px;'>
        <form id="datosBDSize" name="datosBDSize">
          <script>
            function validarOpcion(selectElement,idInput) {
              var selectedValue = selectElement.value;
              if (selectedValue === "otra") {
                document.getElementById(idInput).style.display = "block";
              } else {
                document.getElementById(idInput).style.display = "none";
              }
            }
          </script>  
          <div class="formRow">
            <label for="bdOC">Business Vertical</label>
            <div style="display: grid;">
              <select id="bdOC" onchange="validarOpcion(this,'otherOC')"></select>
              <input class="inputOther" type="text" id="otherOC" style="display: none;" />
            </div>
          </div>
          <div class="formRow">
            <label for="bdPJ">Project</label>
            <div style="display: grid;">
              <select id="bdPJ" onchange="validarOpcion(this,'otherPJ')"></select>
              <input class="inputOther" type="text" id="otherPJ" style="display: none;" />
            </div>
          </div>
          <div class="formRow">
            <label for="bdPM">PM</label>
            <div style="display: grid;">
              <select id="bdPM" onchange="validarOpcion(this,'otherPM')"></select>
              <input class="inputOther" type="text" id="otherPM" style="display: none;" />
            </div>
          </div>
          <div class="formRow">
            <label for="bdTM">TM</label>
            <div style="display: grid;">
              <select id="bdTM" onchange="validarOpcion(this,'otherTM')"></select>
              <input class="inputOther" type="text" id="otherTM" style="display: none;" />
            </div>
          </div>
          <div class="formRow">
            <label for="bdMSH">Main Stakeholder</label>
            <div style="display: grid;">
              <select id="bdMSH" onchange="validarOpcion(this,'otherSH')"></select>
              <input class="inputOther" type="text" id="otherSH" style="display: none;" />
            </div>
          </div>
          <div class="formRow">
            <label for="bdR">Reason</label>
            <div style="display: grid;">
              <select id="bdR" onchange="validarOpcion(this,'otherR')"></select>
              <input class="inputOther" type="text" id="otherR" style="display: none;" />
            </div>
          </div>
          <div class="formRow">
            <label for="bdSF">Starting From<span style="color: red"> *</span></label>
            <select id="bdSF"></select>
          </div>
          <div class="formRow">
            <label for="bdED">Forecasted End Date<span style="color: red"> *</span></label>
            <select id="bdED"></select>
          </div>
          <div class="formRow">
            <label for="mBD">Monthly Business Downsize (U$D)<span style="color: red"> *</span></label>
            <input type="number" id="mBD" name="mBD" min="0">
          </div>
          <div class="formRow">
            <label for="posit"># of Positions</label>
            <input type="number" id="posit" name="posit" min="0">
          </div>
          <div class="formRow">
            <label for="tech">Tech Stack</label>
            <input type="text" id="tech" name="tech">
          </div>
          <div class="formRow">
            <label for="comments">Comments</label>
            <input type="text" id="comments" name="comments">
          </div>

        </form>
      </div>
      <div style='display: flex; margin: 0 auto; padding: 30px; max-width: 200px;justify-content: center;align-items: center;'>
        <button class="buttonRight" id="btnClear">Clear</button>
        <button class="buttonLeft" id="btnAdd">Add</button>
      </div>
      <script>
        document.getElementById("btnClear").addEventListener("click",limpiarForm)
        document.getElementById("btnAdd").addEventListener("click",addANewBDS)

        function limpiarForm(){
          document.getElementById("bdOC").value=""
          document.getElementById("bdPJ").value=""
          document.getElementById("bdPM").value=""
          document.getElementById("bdTM").value=""
          document.getElementById("bdMSH").value=""
          document.getElementById("bdR").value=""
          document.getElementById("bdSF").value=""
          document.getElementById("bdED").value=""
          document.getElementById("mBD").value=""
          document.getElementById("posit").value=""
          document.getElementById("tech").value=""
          document.getElementById("comments").value=""
          document.getElementById("otherOC").value=""
          document.getElementById("otherPJ").value=""
          document.getElementById("otherPM").value=""
          document.getElementById("otherTM").value=""
          document.getElementById("otherSH").value=""
          document.getElementById("otherR").value=""
          document.getElementById("otherOC").style.display = "none"
          document.getElementById("otherPJ").style.display = "none"
          document.getElementById("otherPM").style.display = "none"
          document.getElementById("otherTM").style.display = "none"
          document.getElementById("otherSH").style.display = "none"
          document.getElementById("otherR").style.display = "none"
          swal({
            title: "Notification",
            text: "Form cleaned",
            icon: "success",
          });
        }

        function addANewBDS(){
          swal({
            title: "Notification",
            text: "Are you sure you want to add this Business Downsize?",
            icon: "warning",
            buttons: {
              yes:{
                text: "Yes",
                value: "yes"
              },
              cancel: "No",
            },
          }).then((value) =>{
            switch(value){

              case "yes":

                var dataVal = []
                dataVal.push(document.getElementById("bdSF").value)
                dataVal.push(document.getElementById("bdED").value)
                dataVal.push(document.getElementById("mBD").value)
                if(validarIngreso(dataVal)){
                  swal({
                      title: "Notification",
                      text: "Some required values are missing",
                      icon: "error",
                  });
                }
                else{
                  var fecha1 = new Date(document.getElementById("bdSF").value);
                  var fecha2 = new Date(document.getElementById("bdED").value);
                  if(fecha1 < fecha2){
                    var data = []

                    data.push(validarOther("bdOC","otherOC"))
                    data.push(validarOther("bdPJ","otherPJ"))
                    data.push(validarOther("bdPM","otherPM"))
                    data.push(validarOther("bdTM","otherTM"))
                    data.push(validarOther("bdMSH","otherSH"))
                    data.push(validarOther("bdR","otherR"))
                    data.push(document.getElementById("bdSF").value)
                    data.push(document.getElementById("bdED").value)
                    data.push(document.getElementById("mBD").value)
                    data.push(document.getElementById("posit").value)
                    data.push(document.getElementById("tech").value)
                    data.push(document.getElementById("comments").value)
                    console.log(data)
                    google.script.run.addBDSize(data)
                    limpiarForm()
                    swal({
                      title: "Notification",
                      text: "Business Downsize was added",
                      icon: "success",
                    });
                  }
                  else{
                    swal({
                      title: "Notification",
                      text: "Starting From Date es greater than Forecast End Date",
                      icon: "error",
                    });
                  }
                }
                break;
              
              default:
                swal({
                title: "Notification",
                text: "This Business Downsize was not added",
                icon: "success",
                });
                break;
            }
          });

        }
        function validarOther(idSelect,idOther){
          var valor = ""
          if(document.getElementById(idSelect).value == "otra"){
            if(document.getElementById(idOther).value == ""){
              valor = "Other"
            }
            else{
              valor = document.getElementById(idOther).value
            }
          }
          else{
            valor = document.getElementById(idSelect).value
          }
          return valor
        }
        function validarIngreso(data){
          var vacio=false
          for(var i = 0; i <= data.length; i++){
            if(data[i]==""){
              vacio = true
              break
            }
          }
          return vacio
        }
      </script>
    </div>
    <br></br>
  </body>
</html>